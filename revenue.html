<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>수익정산</title>

  <link rel="stylesheet" href="./css/style.css">

  <style>
    /* ===== 공통 레이아웃 보정 ===== */
    .revenue-page {
      max-width: 1000px;
      margin: 0 auto;
      padding: 24px 16px 40px;
    }

    .revenue-page .page-title {
      font-size: 26px;
      font-weight: 700;
      margin-bottom: 8px;
    }

    .revenue-page .page-desc {
      font-size: 14px;
      color: rgba(255,255,255,0.7);
      margin-bottom: 24px;
    }

    /* ===== 상단 요약 카드 ===== */
    .summary-grid {
      display: grid;
      grid-template-columns: repeat(4, minmax(0, 1fr));
      gap: 16px;
      margin-bottom: 16px;
    }

    .summary-box {
      background: #090d1f;
      border-radius: 14px;
      padding: 14px 16px;
      display: flex;
      flex-direction: column;
      gap: 4px;
      box-shadow: 0 10px 25px rgba(0,0,0,0.5);
    }

    .summary-box .label {
      font-size: 12px;
      color: rgba(255,255,255,0.6);
    }

    .summary-box .value {
      font-size: 22px;
      font-weight: 700;
    }

    .summary-box .sub {
      font-size: 12px;
      color: rgba(255,255,255,0.5);
    }

    /* ===== 출금대기 배너 ===== */
    .withdraw-status {
      background: #050814;
      border-radius: 14px;
      padding: 12px 14px;
      box-shadow: 0 12px 30px rgba(0,0,0,0.6);
      margin-bottom: 16px;
      display: none;
      border: 1px solid rgba(255,255,255,0.08);
    }
    .withdraw-status .title {
      font-size: 14px;
      font-weight: 700;
      margin-bottom: 6px;
    }
    .withdraw-status .line {
      font-size: 13px;
      color: rgba(255,255,255,0.85);
      margin-bottom: 4px;
    }
    .withdraw-status .hint {
      font-size: 12px;
      color: rgba(255,255,255,0.55);
      margin-top: 6px;
    }

    /* ===== 필터 바 ===== */
    .filter-bar {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      align-items: center;
      background: #050814;
      border-radius: 12px;
      padding: 10px 12px;
      margin-bottom: 16px;
    }

    .filter-bar input[type="date"],
    .filter-bar input[type="text"],
    .filter-bar select {
      background: #0b1020;
      color: #fff;
      border-radius: 8px;
      border: 1px solid rgba(255,255,255,0.1);
      padding: 6px 8px;
      font-size: 13px;
    }

    .filter-bar .btn-reset,
    .filter-bar .btn-export {
      border: none;
      border-radius: 8px;
      padding: 6px 10px;
      font-size: 13px;
      cursor: pointer;
    }

    .filter-bar .btn-reset {
      background: #151a2c;
      color: #fff;
    }

    .filter-bar .btn-export {
      background: #4b59ff;
      color: #fff;
    }

    /* ===== 데스크탑용 리스트 ===== */
    .revenue-list {
      background: #050814;
      border-radius: 14px;
      padding: 10px 12px 16px;
      box-shadow: 0 12px 30px rgba(0,0,0,0.6);
    }

    .revenue-list .list-header,
    .revenue-list .list-row {
      display: grid;
      grid-template-columns: 32px minmax(0, 2.4fr) repeat(4, minmax(0, 1fr));
      align-items: center;
      column-gap: 12px;
    }

    .revenue-list .list-header {
      font-size: 13px;
      font-weight: 600;
      color: rgba(255,255,255,0.7);
      padding: 6px 4px;
      border-bottom: 1px solid rgba(255,255,255,0.08);
      margin-bottom: 6px;
    }

    .revenue-list .list-row {
      padding: 8px 4px;
      border-bottom: 1px solid rgba(255,255,255,0.04);
      font-size: 14px;
    }

    .revenue-list .list-row:last-child {
      border-bottom: none;
    }

    .revenue-list .list-row:hover {
      background: rgba(255,255,255,0.02);
    }

    .video-cell {
      display: flex;
      align-items: center;
      gap: 10px;
      min-width: 0;
    }

    .video-cell .thumb {
      width: 46px;
      height: 32px;
      border-radius: 6px;
      background: linear-gradient(135deg, #ff7b74, #ffc15a);
      flex-shrink: 0;
    }

    .video-cell strong {
      display: block;
      font-size: 14px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .video-cell p {
      font-size: 12px;
      color: rgba(255,255,255,0.7);
    }

    .revenue-list span {
      font-size: 14px;
    }

    .revenue-list input[type="checkbox"] {
      width: 16px;
      height: 16px;
    }

    /* ===== 출금 모달 ===== */
    .modal-overlay {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.55);
      display: none;
      align-items: center;
      justify-content: center;
      padding: 18px;
      z-index: 9999;
    }

    .modal {
      width: 100%;
      max-width: 420px;
      background: #050814;
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,0.10);
      box-shadow: 0 20px 60px rgba(0,0,0,0.7);
      overflow: hidden;
    }

    .modal .modal-head {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 12px 14px;
      border-bottom: 1px solid rgba(255,255,255,0.08);
    }

    .modal .modal-title {
      font-size: 14px;
      font-weight: 800;
    }

    .modal .modal-close {
      background: transparent;
      color: rgba(255,255,255,0.8);
      border: none;
      font-size: 18px;
      cursor: pointer;
      padding: 4px 8px;
    }

    .modal .modal-body {
      padding: 14px;
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .field label {
      display: block;
      font-size: 12px;
      color: rgba(255,255,255,0.65);
      margin-bottom: 6px;
    }

    .field input,
    .field select {
      width: 100%;
      background: #0b1020;
      color: #fff;
      border-radius: 10px;
      border: 1px solid rgba(255,255,255,0.12);
      padding: 10px 10px;
      font-size: 14px;
      outline: none;
    }

    .mini-info {
      font-size: 12px;
      color: rgba(255,255,255,0.6);
      margin-top: 2px;
    }

    .error {
      display: none;
      font-size: 12px;
      color: #ff6b6b;
      background: rgba(255, 107, 107, 0.10);
      border: 1px solid rgba(255, 107, 107, 0.25);
      padding: 8px 10px;
      border-radius: 10px;
    }

    .modal .modal-actions {
      display: flex;
      gap: 10px;
      padding: 12px 14px 14px;
      border-top: 1px solid rgba(255,255,255,0.08);
    }

    .btn {
      flex: 1;
      border: none;
      border-radius: 10px;
      padding: 10px 12px;
      font-weight: 700;
      cursor: pointer;
    }

    .btn-cancel {
      background: #151a2c;
      color: #fff;
    }

    .btn-withdraw {
      background: #4b59ff;
      color: #fff;
    }

    .btn-withdraw:disabled {
      opacity: 0.45;
      cursor: not-allowed;
    }

    /* ===== 모바일 레이아웃 ===== */
    @media (max-width: 768px) {
      .revenue-page {
        padding: 16px 10px 32px;
      }

      .summary-grid {
        grid-template-columns: repeat(2, minmax(0, 1fr));
        gap: 10px;
      }

      .filter-bar {
        flex-direction: column;
        align-items: stretch;
      }

      .filter-bar input,
      .filter-bar select,
      .filter-bar button {
        width: 100%;
      }

      .revenue-list {
        padding: 8px 6px 12px;
      }

      .revenue-list .list-header {
        display: none;
      }

      .revenue-list .list-row {
        display: flex;
        flex-wrap: wrap;
        align-items: flex-start;
        row-gap: 6px;
        column-gap: 8px;
        padding: 10px 8px;
        border-radius: 10px;
        margin-bottom: 6px;
      }

      .revenue-list .list-row input[type="checkbox"] {
        order: 1;
        margin-top: 4px;
      }

      .revenue-list .list-row .video-cell {
        order: 2;
        width: calc(100% - 28px);
      }

      .revenue-list .list-row span:nth-of-type(1),
      .revenue-list .list-row span:nth-of-type(2),
      .revenue-list .list-row span:nth-of-type(3),
      .revenue-list .list-row span:nth-of-type(4) {
        flex: 0 0 50%;
        font-size: 13px;
        color: rgba(255,255,255,0.85);
      }

      .revenue-list .list-row span:nth-of-type(1) { order: 3; }
      .revenue-list .list-row span:nth-of-type(2) { order: 4; }
      .revenue-list .list-row span:nth-of-type(3) { order: 5; }
      .revenue-list .list-row span:nth-of-type(4) { order: 6; }

      .revenue-list .list-row span:nth-of-type(1)::before {
        content: "가격 ";
        color: rgba(255,255,255,0.55);
        margin-right: 4px;
      }
      .revenue-list .list-row span:nth-of-type(2)::before {
        content: "구매 ";
        color: rgba(255,255,255,0.55);
        margin-right: 4px;
      }
      .revenue-list .list-row span:nth-of-type(3)::before {
        content: "내수익 ";
        color: rgba(255,255,255,0.55);
        margin-right: 4px;
      }
      .revenue-list .list-row span:nth-of-type(4)::before {
        content: "업로드 ";
        color: rgba(255,255,255,0.55);
        margin-right: 4px;
      }
    }
  </style>
</head>

<body>

<header class="site-header">
  <div class="logo">Patraon</div>
  <button class="menu-toggle">☰</button>

  <nav class="main-nav">
    <a href="index.html">홈</a>
    <a href="projects.html">프로젝트</a>
    <a href="creators.html">크리에이터</a>
    <a href="revenue.html" class="active">수익정산</a>
    <a href="contact.html">문의</a>
  </nav>

  <div class="user-area">
    <span class="user-name">비비커플</span>
    <div class="avatar"></div>
  </div>
</header>

<main class="page revenue-page">

  <h1 class="page-title">영상 수익 정산</h1>
  <p class="page-desc">
    내가 올린 영상들의 매출, 플랫폼 수수료, 정산 금액을 한눈에 확인하는 페이지입니다.
  </p>

  <!-- 상단 요약 카드 -->
  <section class="summary-grid">
    <div class="summary-box">
      <span class="label">총 누적 수익 (USD)</span>
      <span class="value" id="totalNet">$0.00</span>
      <span class="sub">플랫폼 수수료 차감 후</span>
    </div>

    <div class="summary-box">
      <span class="label">출금 가능 금액(USD)</span>
      <span class="value" id="monthlyNet">$0.00</span>
      <span class="sub" id="withdrawHint">출금요청 후 10일 걸립니다.</span>
    </div>

    <div class="summary-box">
      <span class="label">판매 중인 영상</span>
      <span class="value" id="videoCount">0개</span>
      <span class="sub">비공개 / 삭제 영상 제외</span>
    </div>

    <div class="summary-box">
      <span class="label">저번달 수익(USD)</span>
      <span class="value" id="pendingNet">$0.00</span>
      <span class="sub">저번덜 1일~말일</span>
    </div>
  </section>

  <!-- ✅ 출금 대기 상태 배너 -->
  <section class="withdraw-status" id="withdrawStatus">
    <div class="title">출금대기</div>
    <div class="line">요청 금액: <strong id="pendingAmount">$0.00</strong></div>
    <div class="line">은행/계좌: <strong id="pendingAccount">-</strong></div>
    <div class="hint">출금은 요청일 기준 <strong>10일 후</strong>에 입금됩니다.</div>
    
    <button id="cancelWithdrawBtn" style="
    margin-top:10px;
    width:100%;
    background:#151a2c;
    color:#fff;
    border:none;
    border-radius:10px;
    padding:8px;
    font-weight:700;
    cursor:pointer;
    ">
    출금 취소
    </button>
  </section>

  <!-- 필터 영역 -->
  <section class="filter-bar">
    <input type="date">
    <span>~</span>
    <input type="date">
    <input type="text" placeholder="영상 이름으로 검색">
    <select>
      <option>수익 높은 순</option>
      <option>수익 낮은 순</option>
      <option>최신 업로드순</option>
      <option>구매자 많은 순</option>
    </select>

    <button class="btn-reset">필터 초기화</button>
    <button class="btn-export" id="openWithdraw">출금요청</button>
  </section>

  <!-- 영상 리스트 -->
  <section class="revenue-list">
    <div class="list-header">
      <span><input type="checkbox" id="checkAll"></span>
      <span>영상</span>
      <span>가격</span>
      <span>구매</span>
      <span>내수익</span>
      <span>업로드</span>
    </div>
    <div id="revenueRows"></div>
  </section>

</main>

<footer class="site-footer">
  © 2025 수익정산 · 로컬 테스트 페이지
</footer>

<!-- ✅ 출금 모달 -->
<div class="modal-overlay" id="withdrawModal">
  <div class="modal">
    <div class="modal-head">
      <div class="modal-title">출금 요청</div>
      <button class="modal-close" id="closeWithdraw" aria-label="닫기">×</button>
    </div>

    <div class="modal-body">
      <div class="field">
        <label>출금 가능 금액</label>
        <div class="mini-info" id="availableText">$0.00</div>
      </div>

      <div class="field">
        <label>출금 금액 (USD)</label>
        <input type="number" id="withdrawAmount" min="1" step="0.01" placeholder="예: 120.00">
        <div class="mini-info">출금요청 후 10일 걸립니다.</div>
      </div>

      <div class="field">
        <label>은행</label>
        <select id="bankSelect">
          <option value="">은행 선택</option>
          <option>KB국민</option>
          <option>신한</option>
          <option>우리</option>
          <option>하나</option>
          <option>NH농협</option>
          <option>카카오뱅크</option>
          <option>토스뱅크</option>
        </select>
      </div>

      <div class="field">
        <label>계좌번호</label>
        <input type="text" id="accountInput" placeholder="예: 110-123-456789">
      </div>

      <div class="error" id="withdrawError">출금 가능 금액을 초과했습니다. 출금이 불가능합니다.</div>
    </div>

    <div class="modal-actions">
      <button class="btn btn-cancel" id="cancelWithdraw">취소</button>
      <button class="btn btn-withdraw" id="submitWithdraw" disabled>출금하기</button>
    </div>
  </div>
</div>

<script src="./js/main.js"></script>

<script>
  // ====== 1. 영상 데이터 정의 (18개) =======
  const videos = [
    { id: 'VR0001', title: '(L커플 시리즈) 프로필촬영',   price: 10, buyers: 30, date: '2025-11-25', pending: true },
    { id: 'VR0002', title: '(L커플 시리즈) 야릇한 보드게임',    price: 15, buyers: 52, date: '2025-10-12', pending: true },
    { id: 'VR0003', title: '(L커플 시리즈) 교감',         price: 10, buyers: 50, date: '2025-10-05', pending: true },
    { id: 'VR0004', title: '(L커플 시리즈) 첫섹스',       price: 20,  buyers: 151, date: '2025-9-15', pending: false },
    { id: 'VR0005', title: '(비비 커플) 배달원과 함께',    price: 20,  buyers: 2006, date: '2025-9-10', pending: false },
    { id: 'VR0006', title: '(비비 커플) 초대남과 함께',       price: 25,  buyers: 1285, date: '2025-8-15', pending: false },
    { id: 'VR0007', title: '(비비 커플) 여자2,남자1',          price: 20, buyers: 1335, date: '2025-8-05', pending: false },
    { id: 'VR0008', title: '(비비 커플) 센슈얼안마',        price: 15,  buyers: 190, date: '2025-07-28', pending: false },
    { id: 'VR0009', title: '(코스프레 시리즈) 귀멸의칼날',              price: 20,  buyers: 270, date: '2025-07-25', pending: false },
    { id: 'VR0010', title: '(코스프레 시리즈) 원피스',             price: 20,  buyers: 160, date: '2025-07-20', pending: false },
    { id: 'VR0011', title: '(코스프레 시리즈) 나루토',           price: 20, buyers: 202, date: '2025-07-15', pending: false },
    { id: 'VR0012', title: '(존잘,존예 시리즈) 민우',             price: 20,  buyers: 230, date: '2025-07-10', pending: false },
    { id: 'VR0013', title: '(존잘,존예 시리즈) 다영',           price: 25, buyers: 190,  date: '2025-07-05', pending: false },
    { id: 'VR0014', title: '(존잘,존예 시리즈) 야외섹스',          price: 20,  buyers: 940, date: '2025-07-01', pending: false },
    { id: 'VR0015', title: '(존잘,존예 시리즈) 호텔스위트룸',           price: 25, buyers: 576,  date: '2025-06-25', pending: false },
    { id: 'VR0016', title: '(SM시리즈) 속박',       price: 30,  buyers: 840, date: '2025-06-20', pending: false },
    { id: 'VR0017', title: '(SM시리즈) 애널',             price: 25,  buyers: 1075, date: '2025-06-15', pending: false },
    { id: 'VR0018', title: '(SM시리즈) 딜도',             price: 25,  buyers: 2098,  date: '2025-06-10', pending: false },
  ];

  const CREATOR_RATE = 0.8; // 내 수익 비율(80%)

  function formatMoney(num) {
    return '$' + Number(num).toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g, ',');
  }

  // ====== 2. 출금 상태(로컬 저장) ======
  const STORAGE_KEY = 'patraon_withdraw_request_v1';

  function loadWithdrawState() {
    try {
      const raw = localStorage.getItem(STORAGE_KEY);
      return raw ? JSON.parse(raw) : null;
    } catch (e) {
      return null;
    }
  }

  function saveWithdrawState(state) {
    localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
  }

  function clearWithdrawState() {
    localStorage.removeItem(STORAGE_KEY);
  }

  let withdrawState = loadWithdrawState(); 
  // 예시 구조:
  // { amount: 120.00, bank: "신한", account: "110-xxx", requestedAt: "2025-12-15T..." }

  function getWithdrawPendingAmount() {
    return withdrawState && withdrawState.amount ? Number(withdrawState.amount) : 0;
  }

  // ====== 3. 리스트 렌더링 ======
  const rowsContainer = document.getElementById('revenueRows');

  function renderRows() {
    rowsContainer.innerHTML = '';

    videos.forEach(video => {
      const net = video.price * video.buyers * CREATOR_RATE;

      const row = document.createElement('div');
      row.className = 'list-row';
      row.innerHTML = `
        <input type="checkbox">
        <div class="video-cell">
          <div class="thumb"></div>
          <div>
            <strong>${video.title}</strong>
            <p>${formatMoney(video.price)} · ID: ${video.id}</p>
          </div>
        </div>
        <span>${formatMoney(video.price)}</span>
        <span>${video.buyers}</span>
        <span>${formatMoney(net)}</span>
        <span>${video.date}</span>
      `;
      rowsContainer.appendChild(row);
    });
  }

  // ====== 4. 요약 카드 계산 + "출금가능금액 = 기본값 - 출금요청금액" ======
  const totalNetEl   = document.getElementById('totalNet');
  const monthlyNetEl = document.getElementById('monthlyNet');
  const videoCountEl = document.getElementById('videoCount');
  const pendingNetEl = document.getElementById('pendingNet');

  function updateSummary() {
    let totalNet = 0;
    let pendingNet = 0;

    videos.forEach(v => {
      const gross = v.price * v.buyers;
      const net   = gross * CREATOR_RATE;
      totalNet += net;
      if (v.pending) pendingNet += net;
    });

    // 기존 로직 유지(테스트용)
    const baseMonthlyNet = totalNet * 0.15;

    // ✅ 출금요청금액만큼 차감
    const requested = getWithdrawPendingAmount();
    const available = Math.max(0, baseMonthlyNet - requested);

    totalNetEl.textContent   = formatMoney(totalNet);
    monthlyNetEl.textContent = formatMoney(available);
    videoCountEl.textContent = videos.length + '개';

    // ✅ 저번달 금액 고정값
    pendingNetEl.textContent = "$23,012.00";
  }

  // ====== 5. 출금대기 배너 표시/갱신 ======
  const withdrawStatusEl = document.getElementById('withdrawStatus');
  const pendingAmountEl  = document.getElementById('pendingAmount');
  const pendingAccountEl = document.getElementById('pendingAccount');

  function updateWithdrawBanner() {
    if (!withdrawState || !withdrawState.amount) {
      withdrawStatusEl.style.display = 'none';
      return;
    }
    withdrawStatusEl.style.display = 'block';
    pendingAmountEl.textContent = formatMoney(withdrawState.amount);
    pendingAccountEl.textContent = `${withdrawState.bank} / ${withdrawState.account}`;
  }

// ====== 6. 출금 모달 UI ======
const openWithdrawBtn      = document.getElementById('openWithdraw');
const modalOverlay         = document.getElementById('withdrawModal');
const closeWithdrawBtn     = document.getElementById('closeWithdraw');

// ✅ 모달 "취소" 버튼
const modalCancelBtn       = document.getElementById('cancelWithdraw');

// ✅ 배너 "출금 취소" 버튼
const bannerCancelBtn      = document.getElementById('cancelWithdrawBtn');

const submitWithdrawBtn    = document.getElementById('submitWithdraw');

const availableTextEl = document.getElementById('availableText');
const amountInput     = document.getElementById('withdrawAmount');
const bankSelect      = document.getElementById('bankSelect');
const accountInput    = document.getElementById('accountInput');
const errorEl         = document.getElementById('withdrawError');

function computeBaseMonthlyNet() {
  let totalNet = 0;
  videos.forEach(v => totalNet += (v.price * v.buyers * CREATOR_RATE));
  return totalNet * 0.15;
}

function getCurrentAvailable() {
  const base = computeBaseMonthlyNet();
  const requested = getWithdrawPendingAmount();
  return Math.max(0, base - requested);
}

function openModal() {
  if (withdrawState && withdrawState.amount) {
    alert('이미 출금요청이 진행 중입니다. (출금대기)\n출금은 요청일 기준 10일 후에 입금됩니다.');
    return;
  }

  amountInput.value = '';
  bankSelect.value = '';
  accountInput.value = '';
  errorEl.style.display = 'none';
  submitWithdrawBtn.disabled = true;

  availableTextEl.textContent = formatMoney(getCurrentAvailable());
  modalOverlay.style.display = 'flex';
}

function closeModal() {
  modalOverlay.style.display = 'none';
}

function setError(show, message) {
  if (!show) {
    errorEl.style.display = 'none';
    errorEl.textContent = '출금 가능 금액을 초과했습니다. 출금이 불가능합니다.';
    return;
  }
  errorEl.style.display = 'block';
  errorEl.textContent = message;
}

function isValidAccountNumber(account) {
  const regex = /^[0-9-]{6,20}$/;
  return regex.test(account);
}

function validateWithdrawForm() {
  const available = getCurrentAvailable();
  const amt  = Number(amountInput.value || 0);
  const bank = bankSelect.value.trim();
  const acc  = accountInput.value.trim();

  if (!amt || amt <= 0 || !bank || !acc) {
    setError(false);
    submitWithdrawBtn.disabled = true;
    return;
  }

  if (!isValidAccountNumber(acc)) {
    setError(true, '계좌가 잘못되었습니다.');
    submitWithdrawBtn.disabled = true;
    return;
  }

  if (amt > available) {
    setError(true, '출금 가능 금액을 초과했습니다. 출금이 불가능합니다.');
    submitWithdrawBtn.disabled = true;
    return;
  }

  setError(false);
  submitWithdrawBtn.disabled = false;
}

// 이벤트 연결
openWithdrawBtn.addEventListener('click', openModal);
closeWithdrawBtn.addEventListener('click', closeModal);

// ✅ 모달 취소는 "닫기"
modalCancelBtn.addEventListener('click', closeModal);

modalOverlay.addEventListener('click', (e) => {
  if (e.target === modalOverlay) closeModal();
});

amountInput.addEventListener('input', validateWithdrawForm);
bankSelect.addEventListener('change', validateWithdrawForm);
accountInput.addEventListener('input', validateWithdrawForm);

submitWithdrawBtn.addEventListener('click', () => {
  const available = getCurrentAvailable();
  const amt  = Number(amountInput.value || 0);
  const bank = bankSelect.value.trim();
  const acc  = accountInput.value.trim();

  // ✅ 클릭 시에도 최종 검증 (형식 틀리면 상태변화 X)
  if (!isValidAccountNumber(acc)) {
    setError(true, '계좌가 잘못되었습니다.');
    return;
  }
  if (amt > available) {
    setError(true, '출금 가능 금액을 초과했습니다. 출금이 불가능합니다.');
    return;
  }

  withdrawState = {
    amount: amt,
    bank,
    account: acc,
    requestedAt: new Date().toISOString()
  };
  saveWithdrawState(withdrawState);

  closeModal();
  updateWithdrawBanner();
  updateSummary();

  alert('출금요청이 완료되었습니다.\n출금은 요청일 기준 10일 후에 입금됩니다.');
});

// ✅ 배너 출금취소 버튼: "상태 복구"
bannerCancelBtn.addEventListener('click', () => {
  if (!withdrawState) return;

  const ok = confirm('출금 요청을 취소하시겠습니까?\n취소 시 출금 가능 금액이 복구됩니다.');
  if (!ok) return;

  clearWithdrawState();
  withdrawState = null;

  updateWithdrawBanner();
  updateSummary();

  alert('출금 요청이 취소되었습니다.');
});

  // ====== 7. 랜덤 수익 증가 ======
  function tickRandomRevenue() {
    const idx = Math.floor(Math.random() * videos.length);
    const deltaBuyers = Math.floor(Math.random() * 8) + 1;
    videos[idx].buyers += deltaBuyers;

    renderRows();
    updateSummary();
    updateWithdrawBanner();

    const nextTime = Math.floor(Math.random() * 15000) + 1000;
    setTimeout(tickRandomRevenue, nextTime);
  }

  function isValidAccountNumber(account) {
  // 숫자 또는 숫자-숫자 조합만 허용 (6~20자)
  const regex = /^[0-9-]{6,20}$/;
  return regex.test(account);
  }

  

  // 최초 실행
  renderRows();
  updateSummary();
  updateWithdrawBanner();
  tickRandomRevenue();
</script>

</body>
</html>
